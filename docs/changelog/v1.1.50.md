# v1.1.50ï¼šshell.env Hookã€Skills è·¯å¾„æ‰©å±•ã€å†…å­˜æ³„æ¼ä¿®å¤

**å‘å¸ƒæ—¥æœŸ**ï¼š2026å¹´02æœˆ04æ—¥

---

## ä¸€å¥è¯æ€»ç»“

è¿™æ¬¡æ›´æ–°æ–°å¢äº† shell.env Hook è®©æ’ä»¶å¯ä»¥æ³¨å…¥ç¯å¢ƒå˜é‡ï¼ŒSkills ç³»ç»Ÿæ”¯æŒä» `.agents/skills` ç›®å½•è¯»å–ï¼Œä¿®å¤äº† AbortController å†…å­˜æ³„æ¼ï¼Œå¹¶å¤§å¹…æ”¹è¿›æ¡Œé¢ç«¯ä½“éªŒã€‚

---

## æ–°åŠŸèƒ½ï¼šshell.env Hook

### è¿™æ¬¡æ›´æ–°äº†ä»€ä¹ˆï¼Ÿ

æ–°å¢ `shell.env` æ’ä»¶é’©å­ï¼Œå¯ä»¥åœ¨æ‰€æœ‰ shell æ‰§è¡Œç¯å¢ƒä¸­æ³¨å…¥è‡ªå®šä¹‰ç¯å¢ƒå˜é‡ã€‚

### shell.env Hook æ˜¯ä»€ä¹ˆï¼Ÿ

è¿™æ˜¯ä¸€ä¸ªæ’ä»¶äº‹ä»¶é’©å­ï¼Œè®©ä½ å¯ä»¥é€šè¿‡æ’ä»¶å‘ AI å·¥å…·è°ƒç”¨å’Œç”¨æˆ·ç»ˆç«¯æ³¨å…¥ç¯å¢ƒå˜é‡ã€‚æ¯”å¦‚ä½ å¯ä»¥æ³¨å…¥ API Keyã€é¡¹ç›®è·¯å¾„ç­‰ä¿¡æ¯ï¼Œè®© AI åœ¨æ‰§è¡Œå‘½ä»¤æ—¶è‡ªåŠ¨è·å–è¿™äº›å˜é‡ã€‚

### å¦‚ä½•ä½¿ç”¨ï¼Ÿ

åœ¨é¡¹ç›®ä¸­åˆ›å»ºæ’ä»¶æ–‡ä»¶ï¼š

```js
// .opencode/plugins/inject-env.js
export const InjectEnvPlugin = async () => {
  return {
    "shell.env": async (input, output) => {
      output.env.MY_API_KEY = "secret"
      output.env.PROJECT_ROOT = input.cwd
    },
  }
}
```

æ³¨å…¥çš„ç¯å¢ƒå˜é‡å¯¹ AI å·¥å…·æ‰§è¡Œå’Œç”¨æˆ·ç»ˆç«¯éƒ½ç”Ÿæ•ˆã€‚

ğŸ‘‰ **å®Œæ•´æ•™ç¨‹**ï¼š[æ’ä»¶è¿›é˜¶](/5-advanced/12b-plugins-advanced)

---

## æ–°åŠŸèƒ½ï¼šSkills æ”¯æŒ .agents/skills ç›®å½•

### è¿™æ¬¡æ›´æ–°äº†ä»€ä¹ˆï¼Ÿ

Skills ç³»ç»Ÿç°åœ¨æ”¯æŒä» `.agents/skills` ç›®å½•è¯»å– SKILL.md æ–‡ä»¶ï¼Œå…¼å®¹æ›´å¤š Agent æ¡†æ¶çš„ç›®å½•ç»“æ„ã€‚

### æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

å¦‚æœä½ ä½¿ç”¨å…¶ä»– Agent æ¡†æ¶ï¼ˆå¦‚ Claude Codeï¼‰ï¼Œå¯ä»¥æŠŠ Skills æ”¾åœ¨ `.agents/skills/` ç›®å½•ä¸‹ï¼ŒOpenCode ä¹Ÿèƒ½è¯†åˆ«ã€‚

### å®Œæ•´æœç´¢è·¯å¾„

| çº§åˆ« | è·¯å¾„ |
|------|------|
| é¡¹ç›®çº§ OpenCode åŸç”Ÿ | `.opencode/skills/<name>/SKILL.md` |
| å…¨å±€ OpenCode åŸç”Ÿ | `~/.config/opencode/skills/<name>/SKILL.md` |
| é¡¹ç›®çº§ Claude å…¼å®¹ | `.claude/skills/<name>/SKILL.md` |
| å…¨å±€ Claude å…¼å®¹ | `~/.claude/skills/<name>/SKILL.md` |
| é¡¹ç›®çº§ Agent å…¼å®¹ | `.agents/skills/<name>/SKILL.md` |
| å…¨å±€ Agent å…¼å®¹ | `~/.agents/skills/<name>/SKILL.md` |

ğŸ‘‰ **å®Œæ•´æ•™ç¨‹**ï¼š[Skill åŸºï¿½ï¿½](/5-advanced/03a-skills-basics)

---

## æ–°åŠŸèƒ½ï¼šAgent è‡ªå®šä¹‰ä¸»é¢˜è‰²

### è¿™æ¬¡æ›´æ–°äº†ä»€ä¹ˆï¼Ÿ

ç°åœ¨å¯ä»¥åœ¨è‡ªå®šä¹‰ Agent æ—¶è®¾ç½®ä¸»é¢˜é¢œè‰²ï¼Œè®©ä¸åŒ Agent åœ¨ç•Œé¢ä¸Šæ›´å®¹æ˜“åŒºåˆ†ã€‚

---

## é—®é¢˜ä¿®å¤ï¼šAbortController å†…å­˜æ³„æ¼

### ä¹‹å‰çš„é—®é¢˜

é•¿æ—¶é—´ä½¿ç”¨ OpenCode æ—¶ï¼ŒAbortController çš„é—­åŒ…ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå ç”¨è¶Šæ¥è¶Šå¤šå†…å­˜ã€‚

### ç°åœ¨çš„æƒ…å†µ

ä¿®å¤äº† AbortController é—­åŒ…çš„å†…å­˜æ³„æ¼é—®é¢˜ï¼Œé•¿æ—¶é—´ä½¿ç”¨ä¸å†å‡ºç°å†…å­˜æŒç»­å¢é•¿ã€‚

---

## é—®é¢˜ä¿®å¤ï¼šæ’ä»¶é‡å¤å®‰è£…

### ä¹‹å‰çš„é—®é¢˜

æ¯æ¬¡å¯åŠ¨ OpenCode æ—¶ï¼Œæ’ä»¶éƒ½ä¼šè¢«é‡æ–°å®‰è£…ï¼Œå³ä½¿å·²ç»å®‰è£…è¿‡äº†ã€‚

### ç°åœ¨çš„æƒ…å†µ

æ’ä»¶å®‰è£…çŠ¶æ€æ­£ç¡®ç¼“å­˜ï¼Œä¸å†é‡å¤å®‰è£…ã€‚

---

## æ”¹è¿›ï¼šæ¡Œé¢ç«¯ä½“éªŒ

### ä¼šè¯æ ‡ç­¾æ¢å¤

é‡å¯æ¡Œé¢åº”ç”¨åï¼Œä¹‹å‰æ‰“å¼€çš„ä¼šè¯æ ‡ç­¾é¡µä¼šè‡ªåŠ¨æ¢å¤ã€‚

### å‘½ä»¤é¢æ¿æœç´¢

ä¼šè¯æœç´¢åŠŸèƒ½ç§»åˆ°äº†å‘½ä»¤é¢æ¿ä¸­ï¼Œæ“ä½œæ›´ç»Ÿä¸€ã€‚

### ç©ºæç¤ºè¯æäº¤

æ¡Œé¢ç«¯ç°åœ¨å…è®¸åœ¨æœ‰ review comments æ—¶æäº¤ç©ºæç¤ºè¯ã€‚

### é¡¹ç›®ç¼–è¾‘å›¾æ ‡

ç¼–è¾‘é¡¹ç›®å¯¹è¯æ¡†çš„å›¾æ ‡ç°åœ¨åœ¨æ‚¬åœæ—¶æ‰æ˜¾ç¤ºï¼Œç•Œé¢æ›´ç®€æ´ã€‚

---

## å…¶ä»–æ”¹è¿›

- TUI æ–°å¢ `--thinking` æ ‡å¿—ï¼Œå¯åœ¨ run å‘½ä»¤ä¸­æ˜¾ç¤ºæ¨ç†è¿‡ç¨‹
- TUI å‰ªè´´æ¿åœ¨ OSC52 å¤±è´¥åè‡ªåŠ¨å›é€€åˆ°åŸç”Ÿå‰ªè´´æ¿
- CLI `run` å‘½ä»¤æ”¹ä¸ºéäº¤äº’æ¨¡å¼
- Gemini schema éªŒè¯æ”¯æŒåµŒå¥—æ•°ç»„å’Œéå¯¹è±¡ç±»å‹
- Cloudflare AI Gateway æ”¹ç”¨å®˜æ–¹ ai-gateway-provider åŒ…
- æ’é™¤ k2p5 æ¨¡å‹çš„æ¨ç†å˜ä½“
- Provider é…ç½®çš„ headers ç°åœ¨æ­£ç¡®åº”ç”¨åˆ° fetch è¯·æ±‚

---

## è¦ä¸è¦å‡çº§ï¼Ÿ

| æƒ…å†µ | å»ºè®® |
|------|------|
| é‡åˆ°å†…å­˜æ³„æ¼é—®é¢˜ | âœ… å¼ºçƒˆæ¨è |
| ä½¿ç”¨æ’ä»¶ç³»ç»Ÿ | âœ… æ¨èå‡çº§ |
| æ¡Œé¢ç«¯ç”¨æˆ· | âœ… æ¨èå‡çº§ |
| ç”¨å¾—å¥½å¥½çš„ | å¯ä»¥ç­‰ä¸‹æ¬¡ |

**å‡çº§å‘½ä»¤**ï¼š

```bash
opencode upgrade
```

---

## æŠ€æœ¯ç»†èŠ‚ï¼ˆå¯è·³è¿‡ï¼‰

<details>
<summary>ç‚¹å‡»å±•å¼€å®Œæ•´æ›´æ–°åˆ—è¡¨</summary>

### Core
- Prevent memory leaks from AbortController closures (@MaxLeiter)
- Revert addition of Trinity model system prompt support
- Add Trinity model system prompt support (@mariamjabara)
- Add shell.env hook for manipulating environment in tools and shell (@tylergannon)
- Use official ai-gateway-provider package for Cloudflare AI Gateway (@elithrar)
- Allow theme colors in agent customization (@IdrisGit)
- Add support for reading skills from .agents/skills directories
- Provider headers from config not applied to fetch requests (@cloudyan)
- Ensure MCP tools are sanitized
- Add .slnx to C#/F# LSP root detection (@workedbeforepush)
- Improve skills system with better prompting, fix permission requests after skill invocation, and ensure agents can locate scripts and resources
- Exclude k2p5 from reasoning variants (@neavo)
- Handle nested array items for Gemini schema validation (@mugnimaestra)
- Plugins are always reinstalled (@neriousy)
- Strip properties and required fields from non-object types in Gemini schema (@ChickenBreast-ky)
- Make CLI run command non-interactive

### TUI
- Add --thinking flag to show reasoning blocks in run command
- Always fall back to native clipboard after OSC52 (@MartinWie)

### Desktop
- Faster end-to-end tests (@neriousy)
- Update command palette placeholder text
- Model selector truncating too soon
- Improve spacing in application UI
- Allow empty prompt with review comments in desktop (@dbpolito)
- Fixed terminal serialization bug in app
- Don't force mount tooltips in the app
- Restore previously opened session tabs on app restart (@ProdigyRahul)
- Edit project dialog icon now shows on hover (@ProdigyRahul)
- Move session search to command palette
- Fix custom providers overflow in app (@DNGriffin)

</details>

---

[â† è¿”å›æ›´æ–°æ—¥å¿—](./index.md)
