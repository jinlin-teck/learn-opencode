# v1.1.65：Tool Definition Hook

**发布日期**：2026年2月13日

---

## 一句话总结

这次更新为插件添加了 **tool.definition Hook**，可以修改工具描述和参数，同时修复了 Windows ACP 卡死、桌面端多项问题。

---

## 新功能：Tool Definition Hook

### 这次更新了什么？

插件现在可以使用 **tool.definition Hook** 来修改工具的描述和参数。

### 这是什么？

Hook 是插件的扩展点。通过这个新 Hook，插件可以：

- 修改工具的描述文字
- 调整工具的参数定义
- 自定义工具的显示方式

### 应用场景

- 为特定工具添加自定义提示
- 隐藏不需要的工具参数
- 调整工具的默认行为说明

---

## 改进：@目录 使用 Read 工具

### 这次更新了什么？

当你在对话中 @ 一个目录时，OpenCode 现在使用 **Read 工具而不是已弃用的 List 工具**。

### 好处是什么？

- 获取更完整的目录信息
- 行为更一致
- 为未来移除 List 工具做准备

---

## 问题修复：Windows ACP 卡死

### 之前的问题

在 Windows 上，ACP（Agent Communication Protocol）有时会无限期卡在思考状态。

### 现在的情况

修复了这个问题，Windows 上不会再卡死了。

---

## 改进：桌面端

### 事件流重连

桌面应用断开连接后会自动重连事件流，更稳定。

### 批量切换模型

设置中可以 **一次性切换所有提供商的模型**，不用逐个切换。

### 加载页面优化

优化了桌面加载页面，只在需要 SQLite 迁移时才显示加载窗口。

### 通知导航

点击通知会直接导航到对应会话。

### 输入框修复

修复了提示输入框的一些行为问题。

---

## 要不要升级？

| 情况 | 建议 |
|------|------|
| 开发插件 | ✅ 升级 |
| Windows 用户 | ✅ 强烈推荐 |
| 使用桌面版 | ✅ 升级 |
| 用得好好的 | 可以等下次 |

**升级命令**：

```bash
opencode upgrade
```

---

## 技术细节（可跳过）

<details>
<summary>点击展开完整更新列表</summary>

### Core（核心）

- 回退 OPENCODE_CONFIG_CONTENT 中的 token 替换
- @目录 使用 Read 工具而非已弃用的 List 工具
- 添加 tool.definition Hook，允许插件修改工具描述和参数
- 移除 worktree 删除功能
- 解决 Windows 上 ACP 无限期卡在思考状态的问题

### Desktop（桌面应用）

- 断开连接时重连事件流
- 设置中批量切换所有提供商模型
- 清理桌面加载页面
- 通知点击导航到会话
- 修复提示输入框行为问题
- 修复应用中创建 store 失败
- 只在需要 SQLite 迁移时显示加载窗口

### 社区贡献

- @spoons-and-mirrors：添加 tool.definition Hook
- @ASidorenkoCode：修复 Windows ACP 卡死问题
- @Brendonovich：桌面端多项优化（加载页面、SQLite 迁移检测）

</details>

---

[← 返回更新日志](./index.md)
