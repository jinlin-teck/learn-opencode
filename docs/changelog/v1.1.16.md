# v1.1.16：稳定性与体验优化

**发布日期**：2026年1月13日

---

## 一句话总结

这次更新**改进了编辑工具的反馈机制**，让你更清楚地知道代码修改是否成功，同时修复了多个影响日常使用的问题。

---

## 改进：编辑工具反馈优化

### 这次更新了什么？

编辑和写入工具现在会给出更明确的反馈，让你清楚知道：

- 修改是否成功应用
- 如果失败，具体原因是什么

**之前**：有时候不确定代码修改是否真的生效了。

**现在**：每次修改都会有明确的成功/失败提示。

---

## 改进：环境文件读取权限

### 这次更新了什么？

读取 `.env` 等环境配置文件时，现在会**询问用户是否允许**，而不是直接阻止。

**之前**：尝试读取环境文件可能被静默阻止。

**现在**：OpenCode 会弹出权限确认，你可以选择是否允许。

这让你在需要帮助配置环境变量时更加灵活，同时保持了安全性。

---

## 新功能：CLI 调试工具调用

### 这次更新了什么？

现在可以直接在命令行调试工具调用，方便开发和测试。

### 如何使用？

```bash
opencode debug tool <工具名称>
```

这对开发自定义工具或排查问题非常有帮助。

---

## 改进：MCP 服务器配置

### 修复：`mcp add` 命令

**之前的问题**：使用 `mcp add` 添加 MCP 服务器时，配置没有真正写入 OpenCode 配置文件。

**现在**：配置会正确保存，添加的 MCP 服务器下次启动时自动可用。

---

## 改进：子代理权限

### 这次更新了什么？

嵌套子代理现在会正确继承父代理的任务权限设置。

**之前**：有时候子代理的权限设置不生效。

**现在**：权限设置在整个代理调用链中正确传递。

---

## 桌面版更新

- **本地服务器密码**：桌面应用启动的本地服务器现在支持密码保护
- **终端编号优化**：多终端场景下的编号更加智能
- **Windows 修复**：修复 Windows 下 Tauri CLI 启动参数问题

---

## 其他修复

| 问题 | 修复 |
|------|------|
| 切换会话时误提交 | ✅ 已修复 |
| 控制台显示 `[object Object]` 错误 | ✅ 已修复 |
| Cloudflare 提供商的 token 限制错误 | ✅ 已修复 |
| Bedrock 的 Anthropic 模型推理配置 | ✅ 已修复 |

---

## 要不要升级？

| 情况 | 建议 |
|------|------|
| 用过 `mcp add` 但服务器没生效 | ✅ 升级 |
| 使用 Cloudflare 提供商 | ✅ 升级 |
| 使用 AWS Bedrock + Claude | ✅ 升级 |
| 遇到过编辑后不确定是否成功 | ✅ 升级 |
| 用得好好的 | 可以等下次 |

**升级命令**：

```bash
opencode upgrade
```

---

## 技术细节（可跳过）

<details>
<summary>点击展开完整更新列表</summary>

### Core（核心）

- 处理更新 OpenCode 配置 schema 时的写入错误 (@ShoeBoom)
- 确保 zai 模型禁用 clear_thinking
- 改进编辑和写入工具反馈，避免对修改结果产生困惑
- 防止控制台输出 [object Object] 错误 (@lengmodkx)
- 嵌套子代理正确继承父代理任务权限 (@malhashemi)
- 修复 Cloudflare 提供商的 max completion tokens 错误 (@roerohan)
- Bedrock 的 Anthropic 模型使用 reasoningConfig (@Adam8234)
- 在会话元数据中存储 API URL (@jkoelker)
- 添加 nova-2 到区域前缀模型
- 环境文件读取改为询问用户权限
- 使用 Biome check 替代 format 以包含导入排序 (@kynnyhsap)

### TUI（终端界面）

- CLI 支持直接调试工具调用 (@Eric-Guo)
- 切换会话时不再提交 prompt (@LeonMueller-OneAndOnly)
- 设置 API key 时 await auth.set 防止竞态条件 (@darshkpatel)
- `mcp add` 命令现在正确修改 OpenCode 配置 (@paoloricciuti)

### Desktop（桌面版）

- 桌面应用启动本地服务器时带密码 (@Brendonovich)
- 修复 Windows Tauri CLI 启动缺少参数 (@pschiel)
- 实现更好的动态终端编号 (@OpeOginni)
- 服务器选择对话框添加删除按钮 (@OpeOginni)

### 社区贡献（15 位贡献者）

@kynnyhsap, @OpeOginni, @jkoelker, @paoloricciuti, @jerome-benoit, @darshkpatel, @Adam8234, @roerohan, @malhashemi, @pschiel, @lengmodkx, @LeonMueller-OneAndOnly, @Eric-Guo, @ShoeBoom, @Brendonovich

</details>

---

[← 返回更新日志](./index.md)
