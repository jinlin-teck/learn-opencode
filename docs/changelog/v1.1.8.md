# v1.1.8：桌面版性能大提升

**发布日期**：2026年1月9日

---

## 一句话总结

这次更新主要是**桌面版性能优化**，长对话不再卡顿，同时新增了多选问答功能。

---

## 新功能：多选问答

### 这次更新了什么？

OpenCode 现在支持**多选类型的问答**了。当 AI 需要你做选择时，可以同时选择多个选项。

### 使用场景

比如 AI 问你「这个重构需要更新哪些文件？」，你可以一次选择多个文件，而不是一个一个选。

---

## 桌面版：性能大幅提升

这次桌面版做了大量性能优化，特别是**长对话场景**：

| 优化项 | 效果 |
|--------|------|
| Markdown 缓存 | 不再重复渲染已显示的内容 |
| 懒加载 Diff | 代码差异按需加载，不卡顿 |
| 分块加载消息 | 长对话滚动更流畅 |
| 预加载相邻会话 | 切换会话更快 |

**简单说**：长对话不再卡了。

---

## 改进：文件自动补全更精准

### 之前的问题

在输入框用 `@` 引用文件时，自动补全只匹配文件名，有时候找不到想要的文件。

### 现在的情况

现在使用**完整文件路径**进行模糊匹配，更容易找到目标文件。

比如输入 `@comp/but` 可以匹配到 `src/components/Button.tsx`。

---

## 改进：Escape 键不再误触

### 之前的问题

在弹窗（对话框）中按 Escape 键关闭弹窗时，按键事件会「穿透」到主界面，可能触发其他操作。

### 现在的情况

Escape 键事件现在会被弹窗正确拦截，不会影响主界面。

---

## 桌面版：项目侧边栏修复

### 之前的问题

项目侧边栏有时候只显示文件夹名，不显示完整项目名。

### 现在的情况

现在正确显示项目名称了。

---

## 要不要升级？

| 情况 | 建议 |
|------|------|
| 使用桌面版 | ✅ 强烈推荐升级 |
| 长对话经常卡顿 | ✅ 升级 |
| 用得好好的 | 可以等下次 |

**升级命令**：

```bash
opencode upgrade
```

---

## 技术细节（可跳过）

<details>
<summary>点击展开完整更新列表</summary>

### Core（核心）

- 升级 OpenTUI 到 v0.1.70
- 支持多选问答
- 文档添加 cargofmt 说明（@marc2332）

### TUI（终端界面）

- 阻止 Escape 键从弹窗穿透到主界面
- 文件自动补全使用完整路径进行模糊匹配（@bagatka）

### Desktop（桌面版）

- 回退外部链接在默认浏览器打开的修复
- 缓存会话级 store，添加可选的 context gating
- 增量渲染消息，Markdown 缓存，懒加载 Diff
- 控制 hydration 副作用和 store 加载时机
- 预加载相邻会话
- 实现分块消息加载和懒加载 Diff，提升性能
- 修复项目侧边栏文件夹名显示问题（@0xajka）

### 社区贡献

- @marc2332：文档添加 cargofmt
- @bagatka：文件自动补全优化
- @0xajka：项目侧边栏修复
- @Anthuang：添加 Vesper 主题

</details>

---

[← 返回更新日志](./index.md)
